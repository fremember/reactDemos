<!--
 * @Author: fremember
 * @Date: 2021-08-19 08:53:46
 * @Description: 
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生命周期</title>
    <style>
        .title {
            background: orange;
        }
        .lists {
            width: 200px;
            height: 150px;
            background: skyblue;
            overflow: auto;
        }
        .item {
            height: 30px;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/prop-types@15.6/prop-types.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script type="text/babel">
        // class Life extends React.Component {
        //     state = {
        //         opacity: 1
        //     }
        //     clickEvent = () => {
        //         ReactDOM.unmountComponentAtNode(document.getElementById("container"))
        //     }
        //     // 组件挂载完毕时调用
        //     componentDidMount () {
        //         this.timer = setInterval(() => {
        //             let { opacity } = this.state
        //             opacity -= 0.1
        //             if(opacity <= 0) opacity = 1
        //             this.setState({ opacity }) 
        //         }, 200);
        //     }
        //     // 组件将要卸载
        //     componentWillUnmount () {
        //         clearInterval(this.timer)
        //     }
        //     render () {
        //         let { opacity } = this.state
        //         return (
        //             <div>
        //                 <h2 style={{ opacity: opacity }}>React学习！！</h2>
        //                 <button onClick={this.clickEvent}>卸载</button>
        //             </div>
        //         )
        //     }
        // }

        // ReactDOM.render(<Life />, document.getElementById('container'))


        // class Count extends React.Component {
        //     constructor (props) {
        //         super(props)
        //         this.state = { count: 0 }
        //         console.log(1)
        //     }
            
        //     clickEvent = () => {
        //         let { count } = this.state
        //         count += 1
        //         this.setState({ count })
        //     }

        //     componentWillMount () {
        //         console.log(2)
        //     }
        //     componentDidMount () {
        //         console.log(2.1)
        //     }
        //     death = () => {
        //         ReactDOM.unmountComponentAtNode(document.getElementById('container'))
        //     }
        //     shouldComponentUpdate () {
        //         console.log(5)
        //         return true
        //     }
        //     componentWillUnmount () {
        //         console.log(4)
        //     }
        //     componentWillUpdate () {
        //         console.log(6)
        //     }
        //     componentDidUpdate () {
        //         console.log(6.1)
        //     }
        //     force = () => {
        //         this.c()
        //     }
        //     render () {
        //         let { count } = this.state
        //         console.log(3)
        //         return (
        //             <div>
        //                 <h2>当前求和为：{ count }</h2>
        //                 <button onClick={this.clickEvent}>点我+1</button>
        //                 <button onClick={this.death}>卸载</button>
        //                 <button onClick={this.force}>强制更新</button>
        //             </div>
        //         )
        //     }
        // }
        // ReactDOM.render(<Count />, document.getElementById('container'))

        // class ChindrenComp extends React.Component {
        //     constructor (props) {
        //         super(props)
        //         console.log(1)
        //     }
        //     componentWillMount () {
        //         console.log(2)
        //     }
        //     componentDidMount () {
        //         console.log(7)
        //     }
        //     componentWillReceiveProps (props) {
        //         console.log(props)
        //         console.log(4)
        //     }
        //     shouldComponentUpdate () {
        //         console.log(5)
        //         return true
        //     }
        //     componentWillUpdate () {
        //         console.log(6)
        //     }
        //     componentDidUpdate () {
        //         console.log(6.1)
        //     }

        //     render () {
        //         console.log(3)
        //         let { carName } = this.props
        //         return (
        //             <div>我是B组件，{carName}</div>
        //         )
        //     }
        // }
        // class ParentComp extends React.Component {
        //     state = {
        //         carName: '奔驰'
        //     }
        //     changeCar = () => {
        //         this.setState({ carName: '奥迪' })
        //     }
        //     render () {
        //         let { carName } = this.state
        //         return (
        //             <div>
        //                 我是A组件
        //                 <button onClick={this.changeCar}>换车</button>
        //                 <ChindrenComp carName={carName} />
        //             </div>
        //         )
        //     }
        // }
        // ReactDOM.render(<ParentComp />, document.getElementById('container'))

        // class Life extends React.Component {
        //     constructor (props) {
        //         super(props)
        //         this.state = {
        //             count: 0
        //         }
        //         console.log(1)
        //     }
        //     UNSAFE_componentWillMount () {
        //         console.log(2)
        //     }
        //     componentDidMount () {
        //         console.log(4)
        //     }
        //     shouldComponentUpdate () {
        //         console.log(5)
        //         return true
        //     }
        //     UNSAFE_componentWillUpdate () {
        //         console.log(6)
        //     }
        //     componentDidUpdate () {
        //         console.log(7)
        //     }
        //     changeCount = () => {
        //         let { count } = this.state
        //         count++
        //         this.setState({ count })
        //     }
        //     render () {
        //         console.log(3)
        //         let { count } = this.state
        //         return (
        //             <div onClick={ this.changeCount }>state中的值count：{ count }</div>
        //         )
        //     }
        // }
        // ReactDOM.render(<Life />, document.getElementById('container'))

        // class ChildComp extends React.Component {
        //     constructor (props) {
        //         super(props)
        //         this.state = {
        //             isLogin: false
        //         }
        //     }

        //     static getDerivedStateFromProps (nextProps, newProps) {
        //         if(nextProps.isLogin != newProps.isLogin) {
        //             return {
        //                 isLogin: newProps.isLogin
        //             }
        //         }
        //         return null
        //     }

        //     render () {
        //         let { isLogin } = this.state
        //         return (
        //             <div>子组建：{ isLogin ? 'asd' : 123 }</div>
        //         )
        //     }
        // }
        // class ParentComp extends React.Component {
        //     constructor (props) {
        //         super(props)
        //         this.state = {
        //             count: 0,
        //             isLogin: false
        //         }
        //     }
            
        //     changeCount = ()=> {
        //         let { count, isLogin } = this.state
        //         count = Math.random()
        //         isLogin = count > 0.5 ? true : false
        //         this.setState({ count, isLogin })
        //     }
        //     render () {
        //         let { count, isLogin } = this.state
        //         return (
        //             <div>
        //                 <h2 onClick={ this.changeCount }>state中的值count：{ count }</h2>
        //                 <ChildComp isLogin={isLogin} />
        //             </div>
        //         )
        //     }
        // }

        // ReactDOM.render(<ParentComp />, document.getElementById('container'))

        // class Life extends React.Component {
        //     constructor (props) {
        //         super(props)
        //         this.state = { count: 1 }
        //         console.log(1)
        //     }
        //     // static getDerivedStateFromProps () {
        //     //     console.log(2)
        //     //     return null
        //     // }

        //     componentDidMount () {
        //         console.log(4)
        //     }
        //     shouldComponentUpdate () {
        //         console.log(5)
        //         return true
        //     }
        //     componentDidUpdate (preProps, preState, snapshotValue) {
        //         console.log(preProps)// {}
        //         console.log(preState)// {count: 1}
        //         console.log(snapshotValue)// {pxy: 3}
        //         console.log(6)
        //     }
        //     getSnapshotBeforeUpdate () {
        //         console.log(7)
        //         return 'eqw'
        //     }
        //     changeEvent = () => {
        //         let { count } = this.state
        //         count += 1
        //         this.setState({ count })                
        //     }

        //     render () {
        //         console.log(3)
        //         console.log(this.state)
        //         let { count } = this.state
        //         return (
        //             <div onClick={this.changeEvent}>点击+1，结果是：{ count }</div>
        //         )
        //     }
        // }
        // ReactDOM.render(<Life />, document.getElementById('container'))


        class Life extends React.Component {
            state = {
                lists: []
            }
            componentDidMount () {
                setInterval(() => {
                    const { lists } = this.state,
                        len = lists.length,
                        item = `新闻${len + 1}`;
                    if(len <= 20) {
                        this.setState({ lists: [ item, ...lists ] })
                    }
                }, 1000)
            }
            // 更新新闻的时候，列表会向下移动，所以在更新前，让页面停留在某个位置
            getSnapshotBeforeUpdate () {
                return this.refs.lists.scrollHeight
            }
            componentDidUpdate (preProps, preState, snapshotValue) {
                this.refs.lists.scrollTop += this.refs.lists.scrollHeight - snapshotValue
            }
            render () {
                const { lists } = this.state
                return (
                    <ul className="lists" ref="lists">
                        {
                            lists.map(item => <li className="item" key={item}>{item}</li>)
                        }
                    </ul>
                )
            }
        }
        ReactDOM.render(<Life />, document.getElementById('container'))

    </script>
</body>
</html>